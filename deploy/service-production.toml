# Quka AI Production Configuration
# For kb.scimigo.com deployment
#
# SECRETS MANAGEMENT:
# This config uses ${VAR_NAME} syntax for secrets.
# Set these as environment variables or use the entrypoint script
# to fetch from AWS Secrets Manager.
#
# Required environment variables:
#   - QUKA_DB_DSN: PostgreSQL connection string
#   - QUKA_AUTH0_CLIENT_ID: Auth0 client ID
#   - QUKA_AUTH0_CLIENT_SECRET: Auth0 client secret
#   - QUKA_ENCRYPT_KEY: 16-character encryption key
#   - QUKA_REDIS_URL: Redis URL for SSO sessions

addr = ":33033"

[log]
level = "info"
path = ""

[postgres]
# Uses environment variable with no default (required)
dsn = "${QUKA_DB_DSN}"

[site]
default_avatar = "/image/default_avatar.png"

[site.share]
site_title = "Quka.AI Knowledge Base"
site_description = "Quka.AI - Build your second brain"
domain = "kb.scimigo.com"
embedding_domain = "kb.scimigo.com"

[object_storage]
static_domain = "https://kb.scimigo.com"
driver = "s3"

[object_storage.s3]
bucket = "${QUKA_S3_BUCKET:-quka-ai-storage}"
region = "${QUKA_S3_REGION:-us-east-1}"
# Leave empty for AWS S3 with IAM role (recommended)
endpoint = ""
access_key = "${QUKA_S3_ACCESS_KEY:-}"
secret_key = "${QUKA_S3_SECRET_KEY:-}"
use_path_style = false

[custom_config]
# 16-character encryption key for data encryption
encrypt_key = "${QUKA_ENCRYPT_KEY}"

[custom_config.chunk_service]
enabled = false
address = ""
timeout = 10

# Centrifuge WebSocket configuration
[centrifuge]
max_connections = 1000
heartbeat_interval = 25
deployment_mode = "distributed"
redis_url = "${QUKA_REDIS_URL}"
redis_cluster = false
enable_presence = true
enable_history = true
enable_recovery = true
allowed_origins = ["https://kb.scimigo.com", "https://app.scimigo.com"]
max_channel_length = 255
max_message_size = 65536

# Auth0 SSO Configuration
# CRITICAL: Must use same Auth0 tenant as app.scimigo.com for SSO
[auth0]
enabled = true
domain = "${QUKA_AUTH0_DOMAIN:-scimigo.auth0.com}"
client_id = "${QUKA_AUTH0_CLIENT_ID}"
client_secret = "${QUKA_AUTH0_CLIENT_SECRET}"
audience = "${QUKA_AUTH0_AUDIENCE:-https://api.scimigo.com}"
callback_url = "https://kb.scimigo.com/api/v1/auth/callback"
# CRITICAL: Same Redis as math-agents for shared sessions
redis_url = "${QUKA_REDIS_URL}"
